#+TITLE: Init
#+AUTHOR: Chris
#+STARTUP: showeverything
#+PROPERTY: header-args :tangle "~/.emacs.d/init.el"
#+auto_tangle: t

* Base configuration
Common configurations for built-in packages
** Initialize package sources and use-package
#+begin_src emacs-lisp
  ;; Initialize package sources
  (require 'package)
  (setq package-archives '(("melpa" . "https://melpa.org/packages/")
                           ("org" . "https://orgmode.org/elpa/")
                           ("elpa" . "https://elpa.gnu.org/packages/")
                           ("nongnu" . "https://elpa.nongnu.org/nongnu/")))
  (package-initialize)
  (unless package-archive-contents
    (package-refresh-contents))

  ;; Initialize use-package on non-Linux platforms
  (unless (package-installed-p 'use-package)
    (package-install 'use-package))
  (require 'use-package)
  (setq use-package-always-ensure t)
#+end_src
** Disable / configure default window elements
#+begin_src emacs-lisp
  (scroll-bar-mode -1)   ; Disable visible scrollbar
  (tool-bar-mode -1)     ; Disable the toolbar
  (menu-bar-mode -1)     ; Disable the menu bar
  (set-fringe-mode 10)   ; Give some room on the sides
  (column-number-mode 1) ; Enable column numbers in mode-line
#+end_src
** Org-Mode
org-mode related packages and settings
*** org-mode setup
#+begin_src emacs-lisp
  ;; Create ~/Documents/org-files/ directory if it doesn't exist
  (let ((org-dir "~/Documents/org-files/"))
    (unless (file-exists-p org-dir)
      (make-directory org-dir t)))

  (defun my/org-mode-setup ()
    ; (org-indent-mode)
    (auto-fill-mode 1)
    (display-line-numbers-mode -1)
    (setq fill-column 100))

  (use-package org
    :hook (org-mode . my/org-mode-setup))

  ;; Make sure org-indent face is available
  (require 'org-indent)
#+end_src
*** org-mode auto-tangle
Configure auto-tangle so we don't have to manually tangle our init file
#+begin_src emacs-lisp
  (use-package org-auto-tangle
    :defer t
    :hook (org-mode . org-auto-tangle-mode))
#+end_src
*** org-mode structure templates
#+begin_src emacs-lisp
  (require 'org-tempo)
  (add-to-list 'org-structure-template-alist '("el" . "src emacs-lisp"))
  (add-to-list 'org-structure-template-alist '("sch" . "src scheme"))
#+end_src
*** org-roam
I need to set up keybindings to make using org-roam more intuitive
#+begin_src emacs-lisp
  ;; Create ~/Documents/org-files/ directory if it doesn't exist
  (let ((org-roam-dir "~/Documents/org-roam/"))
    (unless (file-exists-p org-roam-dir)
      (make-directory org-roam-dir t)))

  ;; Create ~/Documents/org-files/ directory if it doesn't exist
  (let ((org-roam-daily-dir "~/Documents/org-roam/daily/"))
    (unless (file-exists-p org-roam-daily-dir)
      (make-directory org-roam-daily-dir t)))

  (use-package org-roam
    :ensure t
    :custom
    (org-roam-directory (file-truename "~/Documents/org-roam"))
    (org-roam-completion-everywhere t)
    :bind (("C-c n l" . org-roam-buffer-toggle)
           ("C-c n f" . org-roam-node-find)
           ("C-c n i" . org-roam-node-insert)
           ("C-c n c" . org-roam-capture)
           ;; Dailies
           ("C-c n j" . org-roam-dailies-capture-today)
           :map org-capture-mode-map
           ("C-c C-c" . nil)
           ("C-c C-'" . org-capture-finalize)
           :map org-mode-map
           ("C-M-i"   . completion-at-point))
    :config
    ;; If you're using a vertical completion framework, you might want a more informative completion interface
    (setq org-roam-node-display-template (concat "${title:*} " (propertize "${tags:10}" 'face 'org-tag)))
    (org-roam-db-autosync-mode)
    ;; If using org-roam-protocol
    (require 'org-roam-protocol))

  (setq org-roam-directory (file-truename "~/Documents/org-roam"))

  (defun org-roam-rg ()
    "Ripgrep search the org-roam directory"
    (interactive)
    (unless (boundp 'org-roam-directory)
      (error "org-roam-directory is not set"))
    (let ((default-directory org-roam-directory))
      (counsel-rg nil org-roam-directory "-i" "Search org-roam (case insensitive): ")))

  (global-set-key (kbd "C-c n r") #'org-roam-rg)
#+end_src
*** org-mode font-lock
#+begin_src emacs-lisp
  (add-hook 'org-mode-hook
            (lambda ()
              (font-lock-ensure))) ;; Ensure font-locking on org-mode activation
#+end_src
*** org-agenda
#+begin_src emacs-lisp
  (make-directory "~/Documents/org-agenda/" t)
  (setq org-agenda-files '("~/Documents/org-agenda/agenda.org"))

  (global-set-key (kbd "C-c n a") 'org-agenda)
#+end_src
** Configure ace-window
Much quicker and more useful than the default "C-x o" binding
#+begin_src emacs-lisp
  (global-set-key (kbd "M-o") 'ace-window)
  (global-set-key (kbd "M-O") 'ace-swap-window)
#+end_src
* Theme
** Set theme to standard-light-tinted
#+begin_src emacs-lisp
  ;; Dependency package for standard-themes
  (use-package modus-themes
    :ensure t)

  (use-package standard-themes
    :ensure t
    :init
    (standard-themes-take-over-modus-themes-mode 1)
    :config
    (setq modus-themes-mixed-fonts t)
    (setq modus-themes-italic-constructs t)
    (modus-themes-load-theme 'standard-light-tinted))
#+end_src
* Emacs Dashboard
#+begin_src emacs-lisp
  (use-package dashboard
    :ensure t
    :config
    (dashboard-setup-startup-hook)
    (setq dashboard-banner-logo-title "EMACS")
    (setq dashboard-startup-banner 'logo)
    (setq dashboard-center-content t)
    (setq dashboard-vertically-center-content t)
    (setq dashboard-items '((recents   . 5)
              (projects  . 5)
              (agenda    . 5)
              (bookmarks . 5)
              (registers . 5)))
    (setq dashboard-projects-backend 'projectile)
    (setq dashboard-projects-switch-function 'counsel-projectile-switch-project-action-vc)
    (setq dashboard-display-icons-p t)     ; display icons on both GUI and terminal
    (setq dashboard-icon-type 'nerd-icons) ; use `nerd-icons' package
    (setq dashboard-set-heading-icons t)
    (setq dashboard-set-file-icons t)
    (setq dashboard-filter-agenda-entry 'dashboard-filter-agenda-by-todo)
    (setq dashboard-item-names '(("Agenda for the coming week:" . "Agenda:"))))
#+end_src
* Projectile
#+begin_src emacs-lisp
  (use-package projectile
    :defer t
    :config
    (projectile-load-known-projects))
  
  (projectile-mode +1)
  (define-key projectile-mode-map (kbd "C-c p") 'projectile-command-map)
#+end_src
* Custom functions
** Definitons
*** Visual bell
Disables the audio bell and sets up the visual bell
#+begin_src emacs-lisp
  (defun my/visual-bell ()
    (invert-face 'mode-line-active)
    (invert-face 'mode-line-inactive)
    (run-with-timer 0.1 nil #'invert-face 'mode-line-active)
    (run-with-timer 0.1 nil #'invert-face 'mode-line-inactive))
#+end_src
** Function calls
#+begin_src emacs-lisp
  (setq ring-bell-function #'my/visual-bell)
#+end_src
